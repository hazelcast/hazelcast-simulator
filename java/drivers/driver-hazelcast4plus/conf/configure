#!/usr/bin/env python3

import os.path
import subprocess

import sys

from simulator.util import load_yaml_file, write_file, copy_file, simulator_home

test_name = sys.argv[1]
tests_yaml = load_yaml_file(sys.argv[2])
test_yaml = None
for t in tests_yaml:
    if t.get('name') == test_name:
        test_yaml = t
        break

inventory_target = sys.argv[3]
inventory_yaml = load_yaml_file(sys.argv[4])
coordinator_props_dir = sys.argv[5]

agents_yaml = inventory_yaml.get(inventory_target).get("hosts")
version_spec = test_yaml.get('version')
driver = test_yaml.get('driver')

specific_coordinator_props_dir= f"{coordinator_props_dir}/{inventory_target}"
os.makedirs(specific_coordinator_props_dir)

copy_file(f"{simulator_home}/conf/worker-log4j.xml",f"{specific_coordinator_props_dir}/worker.log4j")
copy_file(f"{simulator_home}/conf/worker.sh",f"{specific_coordinator_props_dir}/worker.sh")
copy_file(f"{simulator_home}/driver/{driver}",f"{specific_coordinator_props_dir}/hazelcast.xml")
copy_file(f"{simulator_home}/driver/{driver}",f"{specific_coordinator_props_dir}/hazelcast.xml")

